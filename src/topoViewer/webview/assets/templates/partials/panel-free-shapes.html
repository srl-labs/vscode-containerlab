<!-- Free Shapes Editor Panel -->
<div
  id="panel-free-shapes"
  class="panel panel-overlay panel-editor fixed overflow-hidden z-[21] draggable-panel flex flex-col"
  style="display: none"
>
  <div class="panel-heading panel-title-bar flex-shrink-0" id="panel-free-shapes-heading">
    <span class="panel-title" id="panel-free-shapes-title">Add Shape</span>
    <button class="panel-close-btn" id="panel-free-shapes-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="panel-block p-4 overflow-y-auto" id="panel-free-shapes-content">
    <div class="space-y-4">
      <!-- Shape Type Selector -->
      <div class="form-group">
        <label for="free-shapes-type" class="vscode-label mb-1">Shape Type:</label>
        <select id="free-shapes-type" class="input-field w-full">
          <option value="rectangle">Rectangle</option>
          <option value="circle">Circle</option>
          <option value="line">Line</option>
        </select>
      </div>

      <!-- Size controls (for rectangle and circle) -->
      <div id="free-shapes-size-controls" class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label for="free-shapes-width" class="vscode-label mb-1">Width:</label>
          <input
            id="free-shapes-width"
            type="number"
            min="5"
            max="2000"
            class="input-field w-full"
          />
        </div>
        <div class="form-group">
          <label for="free-shapes-height" class="vscode-label mb-1">Height:</label>
          <input
            id="free-shapes-height"
            type="number"
            min="5"
            max="2000"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Fill controls (hidden for lines) -->
      <div id="free-shapes-fill-controls" class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label for="free-shapes-fill-color" class="vscode-label mb-1">Fill Color:</label>
          <input id="free-shapes-fill-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label for="free-shapes-fill-opacity" class="vscode-label mb-1">Fill Opacity:</label>
          <input
            id="free-shapes-fill-opacity"
            type="range"
            min="0"
            max="100"
            step="1"
            class="input-field w-full"
          />
          <span id="free-shapes-fill-opacity-value" class="text-xs text-[var(--text-secondary)]">
            100%
          </span>
        </div>
      </div>

      <!-- Border/Line controls -->
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label
            id="free-shapes-border-color-label"
            for="free-shapes-border-color"
            class="vscode-label mb-1"
          >
            Border Color:
          </label>
          <input id="free-shapes-border-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label
            id="free-shapes-border-width-label"
            for="free-shapes-border-width"
            class="vscode-label mb-1"
          >
            Border Width:
          </label>
          <input
            id="free-shapes-border-width"
            type="number"
            min="0"
            max="20"
            step="1"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Border/Line Style -->
      <div class="form-group">
        <label
          id="free-shapes-border-style-label"
          for="free-shapes-border-style"
          class="vscode-label mb-1"
        >
          Border Style:
        </label>
        <select id="free-shapes-border-style" class="input-field w-full">
          <option value="solid">Solid</option>
          <option value="dashed">Dashed</option>
          <option value="dotted">Dotted</option>
        </select>
      </div>

      <!-- Rectangle-specific: Corner Radius -->
      <div id="free-shapes-corner-radius-control" class="form-group">
        <label for="free-shapes-corner-radius" class="vscode-label mb-1">Corner Radius:</label>
        <input
          id="free-shapes-corner-radius"
          type="number"
          min="0"
          max="100"
          step="1"
          class="input-field w-full"
        />
      </div>

      <!-- Line-specific controls -->
      <div id="free-shapes-line-controls" class="form-group" style="display: none">
        <div class="flex items-center gap-4 mb-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input id="free-shapes-line-start-arrow" type="checkbox" class="vscode-checkbox" />
            <span class="checkbox-label">Start Arrow</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input id="free-shapes-line-end-arrow" type="checkbox" class="vscode-checkbox" />
            <span class="checkbox-label">End Arrow</span>
          </label>
        </div>
        <div>
          <label for="free-shapes-arrow-size" class="vscode-label mb-1">Arrow Size:</label>
          <input
            id="free-shapes-arrow-size"
            type="number"
            min="5"
            max="50"
            step="1"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Rotation (hidden for lines) -->
      <div id="free-shapes-rotation-control" class="form-group">
        <label for="free-shapes-rotation" class="vscode-label mb-1">Rotation (deg):</label>
        <input
          id="free-shapes-rotation"
          type="number"
          min="-360"
          max="360"
          step="1"
          class="input-field w-full"
        />
      </div>

      <!-- Quick Actions -->
      <div class="flex flex-wrap items-center gap-2">
        <button id="free-shapes-transparent-btn" class="btn btn-small btn-outlined">
          Transparent Fill
        </button>
        <button id="free-shapes-no-border-btn" class="btn btn-small btn-outlined">No Border</button>
      </div>
    </div>
  </div>

  <!-- Footer with buttons (same style as editor-footer-template) -->
  <div
    id="panel-free-shapes-footer"
    class="panel-block flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--vscode-panel-border)] bg-[var(--vscode-sideBar-background)] flex-shrink-0"
  >
    <button
      id="free-shapes-ok-btn"
      class="btn btn-primary btn-small"
      title="Apply changes and close"
    >
      OK
    </button>
    <button
      id="free-shapes-apply-btn"
      class="btn btn-outlined btn-small"
      title="Apply changes without closing"
    >
      Apply
    </button>
  </div>

  <script>
    (function () {
      const panel = document.getElementById("panel-free-shapes");
      const content = document.getElementById("panel-free-shapes-content");
      const footer = document.getElementById("panel-free-shapes-footer");

      function resizeContent() {
        if (!panel || !content || !footer) return;
        const panelRect = panel.getBoundingClientRect();
        const contentRect = content.getBoundingClientRect();
        const footerHeight = footer.getBoundingClientRect().height;

        const availableHeight = panelRect.height - (contentRect.top - panelRect.top) - footerHeight;

        if (availableHeight > 0) {
          content.style.height = `${availableHeight}px`;
        }
      }

      const resizeObserver = new ResizeObserver(() => {
        resizeContent();
      });

      resizeObserver.observe(panel);
      setTimeout(resizeContent, 100);
    })();
  </script>
</div>
